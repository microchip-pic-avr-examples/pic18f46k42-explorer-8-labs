pipeline {
    agent {
        kubernetes {
            label 'pic18f46k42-explorer-8-labs'
			defaultContainer 'xc8-mplabx'
            yamlFile 'cloudprovider.yml'
        }
    }

    parameters {
        string( name: 'NOTIFICATION_EMAIL',
                defaultValue: 'gaurang.gunde@microchip.com',
                description: "Email to send build failure and fixed notifications.")
    }
	
	environment {		
		GITHUB_URL ='https://github.com/gauranggunde/pic18f46k42-explorer-8-labs.git'
		BITBUCKET_URL = 'https://bitbucket.microchip.com/scm/ebe/pic18f46k42-explorer-8-labs.git'
		DEPLOY_TOOL_URL = 'https://bitbucket.microchip.com/scm/~i15232/example-github-deployment-strategy-1.git'
		DEPLOY_SCRIPT_DIR = 'example-github-deployment-strategy-1'
		DEPLOY_SCRIPT_FILE = 'deploy-source-as-is.sh'
	}

    options {
        timestamps()
        timeout(time: 20, unit: 'MINUTES')
    }

    stages {
        stage('Checkout') {
            steps {
				checkout scm
            }
        }

		stage('Build') {
            steps {
				script {
					execute("git clone https://bitbucket.microchip.com/scm/citd/tool-mplabx-c-build.git")						
					execute("cd tool-mplabx-c-build && node buildLauncher.js sp=../ rp=./output genMK=true")		 
				}
            }
        }	
		
	}
}

def execute(String cmd) {
	if(isUnix()) {
		sh cmd
	} else {
		bat cmd
	}
}

